# REST API-сервис для создания объявления по грузоперевозкам
_REST API-сервис для создания объявления по грузоперевозкам_ — это интерфейс, который позволяет управлять объявлениями с помощью http-запросов к специальному серверу. 
Синтаксис запросов и тип возвращаемых ими данных строго определены на стороне самого сервиса.
Например, для получения информации о пользователе необходимо составить запрос такого вида:
```
http://localhost:8080/api/user/info?id=2
```

## Оглавление
1. [Запуск](#Запуск)
2. [Сборка](#Сборка)
3. [База данных](#База-данных)
4. [Описание методов API](#Описание-методов-API)
5. [Запросы](#Запросы)
6. [Коды ошибок](#Коды-ошибок)

## Запуск
Для разработки запускать в конфигурации:
```
--spring.profiles.active=dev
```

## Сборка
```bash
mvn clean istall
```

## База данных
Создать БД spring_cargo
```sql
mysql -u root -p
CREATE DATABASE spring_cargo DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE spring_cargo_chat DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
```
Изменить поля в application-dev.properties
```properties
spring.datasource.url = jdbc:mysql://[host]:[port]/spring_cargo?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&useLegacyDatetimeCode=false&characterEncoding=utf8
spring.datasource.username = [username]
spring.datasource.password = [password]
```
## Описание методов API
URL             |Тип|Описание                 |
----------------|----|------------------------|
[api/auth/sign-in](#api/auth/signin-(POST))|POST|Авторизация пользователя|
[api/auth/sign-up](#api/auth/signup-(POST))|POST|Регистрация пользователя|
[api/auth/accountVerification/{token}](#api/auth/accountVerification/{token}-(GET))|GET|Подтверждение регистрации пользователя|
[api/user/info](#api/user/info-(GET))|GET|Получить информацию о пользователе|
[api/user](#api/user-(GET))|GET|Получить всех пользователей|
[api/user](#api/user-(PUT))|PUT|Редактирование пользователя|
[api/user](#api/user-(DELETE))|DELETE|Удалить пользователя|
[api/order](#api/order-(POST))|POST|Создание объявления|
[api/order](#api/order-(GET))|GET|Получить все объявления|
[api/order](#api/order-(PUT))|PUT|Редактирование объявления|
[api/order](#api/order-(DELETE))|DELETE|Удалить объявление|
[api/order/status](#api/order/status-(PUT))|PUT|Обновить статус объявления|
[api/order/info](#api/order/info-(GET))|GET|Получить информацию об объявлении|
[api/image/upload](#api/image/upload-(POST))|POST|Загрузка изображений на сервер|
[api/image/{filename:.+}](#api/image/{filename:.+}-(GET))|GET|Получение изображения|


## Запросы
### api/auth/sign-in (POST) <a name="api/auth/signin-(POST)"></a>
Авторизация пользователя
* Тело: 
    * **email** (_строка_) - логин пользователя
    * **password** (_строка_) - пароль пользователя
* Результат: 
    * **userId** (_положительное число_) - идентификатор пользователя
    * **accessToken** (_строка_) - токен для доступа
    * **role** (_строка_) - роль пользователя
    
### api/auth/sign-up (POST)
Регистрация пользователя
* Тело: 
    * **email** (_строка_) - логин пользователя
    * **password** (_строка_) - пароль пользователя
    * **name** (_строка_) - имя пользователя
    * **role** (_строка_) - роль пользователя (USER, ADMIN или MODERATOR)
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/auth/accountVerification/{token} (GET)
Подтверждение регистрации пользователя
* Параметры: 
    * **token** (_строка_) - токен для активации аккаунта
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/user/info (GET)
Получить информацию о пользователе
* Параметры: 
    * **id** (_положительное число_) - идентификатор пользователя
* Результат: После успешного выполнения возвращает объект, описывающий пользователя.

### api/user (GET)
Получить всех пользователей
* Результат: После успешного выполнения возвращает массив объектов, описывающих пользователей.
* _Примечание_: Доступно только для роли ADMIN

### api/user (PUT)
Редактирование пользователя
* Тело: 
    * **email** (_строка_) - логин пользователя
    * **password** (_строка_) - пароль пользователя
    * **name** (_строка_) - имя пользователя
    * **role** (_строка_) - роль пользователя (USER, ADMIN или MODERATOR)
* Параметры: 
    * **id** (_положительное число_) - идентификатор пользователя
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/user (DELETE)
Удалить пользователя
* Параметры: 
    * **id** (_положительное число_) - идентификатор пользователя
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/order (POST)
Создание объявления
* Тело: 
    * **title** (_строка_) - название объявления
    * **description** (_строка_) - описание объявления
    * **type** (_строка_) - тип объявления
    * **addressSender** (_строка_) - адрес отправления
    * **addressRecipient** (_строка_) - адрес получение
    * **price** (_положительное число_) - цена
    * **departDate** (_строка_) - дата отправления
    * **arrivalDate** (_строка_) - дата получения
    * **size** (_объект_) - объект с размерами:
        *  **width** (_положительное число_) - ширина
        *  **height** (_положительное число_) - высота
        *  **length** (_положительное число_) - длина
        *  **weight** (_положительное число_) - вес
    * **imagesId** (_строка_) - массив идентификаторов изображений.
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/order (GET)
Получить все объявления
* Результат: После успешного выполнения возвращает массив объектов, описывающих объявление.

### api/order/info (GET)
Получить информацию об объявлении
* Параметры: 
    * **id** (_положительное число_) - идентификатор объявления
* Результат: После успешного выполнения возвращает объект, описывающий объявление.

### api/order (PUT)
Редактирование объявления
* Тело: 
    * **title** (_строка_) - название объявления
    * **description** (_строка_) - описание объявления
    * **type** (_строка_) - тип объявления
    * **addressSender** (_строка_) - адрес отправления
    * **addressRecipient** (_строка_) - адрес получение
    * **price** (_положительное число_) - цена
    * **departDate** (_строка_) - дата отправления
    * **arrivalDate** (_строка_) - дата получения
    * **size** (_объект_) - объект с размерами:
        *  **width** (_положительное число_) - ширина
        *  **height** (_положительное число_) - высота
        *  **length** (_положительное число_) - длина
        *  **weight** (_положительное число_) - вес
    * **imagesId** (_строка_) - массив идентификаторов изображений.
* Параметры:     
    * **id** (_положительное число_) - идентификатор объявления
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/order/status (PUT)
Обновить статус объявления
* Параметры:
    * **status** (_строка_) - статус объявления
    * **id** (_положительное число_) - идентификатор объявления
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/order (DELETE)
Удалить объявление
* Параметры: 
    * **id** (_положительное число_) - идентификатор объявления
* Результат: После успешного выполнения возвращает 1.
* Коды ошибок: В ходе выполнения могут произойти общие ошибки. Их описание находится в разделе [коды ошибок](#Коды-ошибок).

### api/image/upload (POST)
Загрузка изображений на сервер
* Параметры: 
    * **files** (_массив_) - массив изображений
* Результат: После успешного выполнения возвращает массив идентификаторов изображений.

### api/image/{filename:.+} (GET)
Получение изображения
* Параметры: 
    * **filename** (_строка_) - название файла с расширением
* Результат: После успешного выполнения возвращает изображение.

## Коды ошибок
Код | Описание
----|-----------
2   | не найден пользователь,
3   | такой пользователь существует
4   | роль не найдена
5   | сообщение не найдено
6   | пустой файл
7   | неправильное имя файла
8   | ошибка загрузки файла
9   | объявление не найдено
